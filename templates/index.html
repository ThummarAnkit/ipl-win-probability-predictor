<!DOCTYPE html>
<html>

<head>
    <title>IPL Win Predictor</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="/static/script.js" defer></script>
</head>

<body>
    <h1>IPL Win Probability Predictor</h1>

    {% if error %}
    <div class="error-message">
        {{ error }}
    </div>
    {% endif %}

    <form method="post">
        <div class="row">
            <div class="col">
                <label>Match Type</label>
                <select id="match_type" name="match_type" required>
                    {% for m in match_type %}
                    <option value="{{ m }}" {% if form_values and form_values.match_type==m %}selected{% endif %}>{{ m
                        }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col">
                <label>City</label>
                <select id="city" name="city" required>
                    {% for city in cities %}
                    <option value="{{ city }}" {% if form_values and form_values.city==city %}selected{% endif %}>{{
                        city }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <div class="row">
            <div class="col">
                <label>Batting Team</label>
                <select id="batting_team" name="batting_team" required onchange="updateTeams('batting')">
                    <option value="">Select Batting Team</option>
                    {% for t in teams %}
                    <option value="{{ t }}" {% if form_values and form_values.batting_team==t %}selected{% endif %} {%
                        if form_values and form_values.bowling_team==t %}disabled{% endif %}>
                        {{ t }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col">
                <label>Bowling Team</label>
                <select id="bowling_team" name="bowling_team" required onchange="updateTeams('bowling')">
                    <option value="">Select Bowling Team</option>
                    {% for t in teams %}
                    <option value="{{ t }}" {% if form_values and form_values.bowling_team==t %}selected{% endif %} {%
                        if form_values and form_values.batting_team==t %}disabled{% endif %}>
                        {{ t }}
                    </option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <div class="row">
            <div class="col">
                <label>Target Runs</label>
                <input id="target" type="number" min="1" name="target" required
                    value="{{ form_values.target if form_values else '' }}" onchange="updateScoreMax()">
            </div>
            <div class="col">
                <label>Target Overs</label>
                <input id="target_overs" type="number" min="5" max="20" name="target_overs" required
                    value="{{ form_values.target_overs if form_values else '' }}" onchange="updateOversMax()">
            </div>
        </div>

        <div class="row">
            <div class="col">
                <label>Score</label>
                <input id="score" type="number" min="0" name="score" required
                    value="{{ form_values.score if form_values else '' }}" onchange="updateBatsmanScore()">
            </div>
            <div class="col">
                <label>Wickets</label>
                <input id="wickets" type="number" min="0" max="9" name="wickets" required
                    value="{{ form_values.wickets if form_values else '' }}">
            </div>
        </div>

        <div class="row">
            <div class="col">
                <label>Overs Completed</label>
                <input id="overs" type="number" min="0" name="overs" required
                    value="{{ form_values.overs if form_values else '' }}">
            </div>
            <div class="col">
                <label>Balls Bowled in Current Over</label>
                <input id="balls" type="number" min="0" max="5" name="balls" required
                    value="{{ form_values.balls if form_values else '' }}">
            </div>
        </div>

        <div class="row">
            <div class="col">
                <label>Batsman Runs</label>
                <input id="batsman_runs" type="number" min="0" name="batsman_runs" required
                    value="{{ form_values.batsman_runs if form_values else '' }}"
                    onchange="updateBatsmanScore('batsman')">
            </div>
            <div class="col">
                <label>Batsman Strike Rate</label>
                <input id="batsman_strikerate" type="number" min="0" max="600" step="0.01" name="batsman_strikerate"
                    required value="{{ form_values.batsman_strikerate if form_values else '' }}">
            </div>
        </div>

        <div class="row">
            <div class="col">
                <label>Non-Striker Runs</label>
                <input id="non_striker_runs" type="number" min="0" name="non_striker_runs" required
                    value="{{ form_values.non_striker_runs if form_values else '' }}"
                    onchange="updateBatsmanScore('nonStriker')">
            </div>
            <div class="col">
                <label>Non-Striker Strike Rate</label>
                <input id="non_striker_strikerate" type="number" min="0" max="600" step="0.01"
                    name="non_striker_strikerate" required
                    value="{{ form_values.non_striker_strikerate if form_values else '' }}">
            </div>
        </div>

        <div style="text-align:center; margin-top:20px;">
            <button type="submit">Predict</button>
        </div>
    </form>

    {% if prediction %}
    <div class="result">
        <h3>Input Summary:</h3>
        <ul>
            <li><strong>Remaining Runs</strong>: {{ input_data['target_runs']-input_data['current_score'] }} |
                <strong>Remaining Balls</strong>: {{
                6*(input_data['target_runs']-input_data['current_score'])/input_data['rrr'] }}
            </li>
            <li><strong>CRR</strong>: {{ input_data['crr'] }} | <strong>RRR</strong>: {{ input_data['rrr'] }}</li>
            <li><strong>Batsman Runs Scored</strong>: {{ input_data['batter_total_runs'] }} | <strong>Batsman
                    StrikeRate</strong>: {{ input_data['batter_strikerate'] }}</li>
            <li><strong>Non-Striker Runs Scored</strong>: {{ input_data['non_striker_runs'] }} | <strong>Non-Striker
                    StrikeRate</strong>: {{ input_data['non_striker_strikerate'] }}</li>
        </ul>
        <h2>Prediction Result</h2>
        <p><strong>{{ prediction.batting_team }}</strong> Win Probability: <strong>{{ prediction.bat_win }}%</strong>
        </p>
        <p><strong>{{ prediction.bowling_team }}</strong> Win Probability: <strong>{{ prediction.bowl_win }}%</strong>
        </p>

    </div>
    {% endif %}
</body>

</html>